<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MovieHub - Stream & Download</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-color: #7c3aed;
        --primary-dark: #6d28d9;
        --dark-bg: #111827;
        --gray-bg: #1f2937;
        --card-bg: #1f2937;
        --card-hover: #2d3748;
        --gray-text: #9ca3af;
        --light-text: #f9fafb;
        --success: #10b981;
        --warning: #f59e0b;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #0f172a, #1e293b);
        color: var(--light-text);
        line-height: 1.6;
        min-height: 100vh;
      }

      /* Header Styles */
      .navbar {
        display: flex;
        flex-direction: column;
        background: rgba(31, 41, 55, 0.9);
        backdrop-filter: blur(10px);
        padding: 1rem 2rem;
        gap: 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        border-bottom: 1px solid rgba(124, 58, 237, 0.2);
      }

      .navbar-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1.5rem;
      }

      .logo {
        font-size: 1.8rem;
        font-weight: 800;
        color: var(--primary-color);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .logo i {
        font-size: 1.5rem;
      }

      .search-container {
        flex: 1;
        min-width: 200px;
        max-width: 600px;
        position: relative;
      }

      .search-bar {
        width: 100%;
        padding: 0.8rem 1.2rem;
        padding-left: 3rem;
        border-radius: 50px;
        border: 1px solid #374151;
        background-color: rgba(17, 24, 39, 0.8);
        color: white;
        font-size: 1rem;
        transition: all 0.3s;
      }

      .search-bar:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.3);
      }

      .search-icon {
        position: absolute;
        left: 1.2rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-text);
      }

      .user-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
      }

      .btn {
        padding: 0.6rem 1.2rem;
        border-radius: 8px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-dark);
      }

      .btn-outline {
        background: transparent;
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
      }

      .btn-outline:hover {
        background: rgba(124, 58, 237, 0.1);
      }

      /* Filter Styles */
      .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 0.8rem;
        margin-top: 0.5rem;
      }

      .filter-btn {
        padding: 0.5rem 1.2rem;
        border-radius: 50px;
        background-color: rgba(55, 65, 81, 0.7);
        color: var(--light-text);
        border: 1px solid #374151;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .filter-btn.active {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .filter-btn:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      /* Main Content */
      .movie-section {
        max-width: 1400px;
        margin: 2rem auto;
        padding: 0 1.5rem;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .section-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: white;
        display: flex;
        align-items: center;
        gap: 0.8rem;
      }

      .sort-options {
        background: var(--gray-bg);
        padding: 0.5rem 1rem;
        border-radius: 8px;
        border: 1px solid #374151;
        color: var(--light-text);
      }

      .movie-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 1.8rem;
      }

      /* Movie Card Styles */
      .movie-card {
        background-color: var(--card-bg);
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        height: 100%;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        position: relative;
      }

      .movie-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
        background-color: var(--card-hover);
      }

      .movie-poster {
        width: 100%;
        height: 300px;
        object-fit: cover;
        display: block;
        background: linear-gradient(45deg, #2d3748, #1a202c);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--gray-text);
      }

      .movie-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        background: var(--primary-color);
        color: white;
        padding: 0.3rem 0.7rem;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 600;
        z-index: 2;
      }

      .movie-content {
        padding: 1.2rem;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
      }

      .movie-title {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: white;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .movie-desc {
        font-size: 0.9rem;
        color: var(--gray-text);
        margin-bottom: 1rem;
        flex-grow: 1;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .movie-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85rem;
        color: var(--gray-text);
      }

      .rating {
        display: flex;
        align-items: center;
        gap: 0.3rem;
        color: var(--warning);
        font-weight: 600;
      }

      .movie-actions {
        display: flex;
        gap: 0.8rem;
        margin-top: 1rem;
      }

      .action-btn {
        flex: 1;
        padding: 0.5rem;
        border-radius: 6px;
        background: rgba(55, 65, 81, 0.7);
        color: white;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.85rem;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.3rem;
      }

      .action-btn:hover {
        background: var(--primary-color);
      }

      .download-btn {
        background: var(--success);
      }

      .download-btn:hover {
        background: #0da271;
      }

      /* Pagination Styles */
      .pagination {
        display: flex;
        justify-content: center;
        gap: 0.6rem;
        margin-top: 3rem;
        flex-wrap: wrap;
      }

      .pagination button {
        padding: 0.6rem 1.1rem;
        background-color: #374151;
        border: none;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .pagination button.active {
        background-color: var(--primary-color);
      }

      .pagination button:hover:not(.active) {
        background-color: #4b5563;
      }

      /* Loading State */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 3rem;
        grid-column: 1 / -1;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(124, 58, 237, 0.3);
        border-radius: 50%;
        border-top-color: var(--primary-color);
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Footer Styles */
      .footer {
        background: var(--gray-bg);
        padding: 2rem;
        margin-top: 3rem;
        text-align: center;
        border-top: 1px solid rgba(124, 58, 237, 0.2);
      }

      .footer p {
        color: var(--gray-text);
        margin-top: 1rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .navbar-top {
          flex-direction: column;
          align-items: stretch;
        }

        .logo {
          justify-content: center;
        }

        .user-actions {
          justify-content: center;
        }

        .movie-grid {
          grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
          gap: 1.2rem;
        }
      }

      @media (max-width: 480px) {
        .movie-grid {
          grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        }

        .movie-actions {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <div class="navbar-top">
        <div class="logo">
          <i class="fas fa-film"></i>
          <span>MovieHub</span>
        </div>

        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input
            type="text"
            class="search-bar"
            placeholder="Search movies..."
            id="searchInput"
          />
        </div>

        <div class="user-actions">
          <button class="btn btn-outline">
            <i class="fas fa-user"></i>
            Sign In
          </button>
          <button class="btn btn-primary">
            <i class="fas fa-crown"></i>
            Premium
          </button>
        </div>
      </div>

      <div class="filters" id="filters">
        <button class="filter-btn active" data-filter="all">
          <i class="fas fa-globe"></i>
          All
        </button>
        <button class="filter-btn" data-filter="Action">
          <i class="fas fa-explosion"></i>
          Action
        </button>
        <button class="filter-btn" data-filter="Drama">
          <i class="fas fa-theater-masks"></i>
          Drama
        </button>
        <button class="filter-btn" data-filter="Comedy">
          <i class="fas fa-laugh"></i>
          Comedy
        </button>
        <button class="filter-btn" data-filter="Sci-Fi">
          <i class="fas fa-rocket"></i>
          Sci-Fi
        </button>
        <button class="filter-btn" data-filter="Thriller">
          <i class="fas fa-mask"></i>
          Thriller
        </button>
      </div>
    </nav>

    <section class="movie-section">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-fire"></i>
          Popular Movies
        </h2>
        <select class="sort-options" id="sortOptions">
          <option value="default">Sort by Default</option>
          <option value="rating">Sort by Rating</option>
          <option value="newest">Sort by Newest</option>
        </select>
      </div>

      <div class="movie-grid" id="movieGrid">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading movies...</p>
        </div>
      </div>

      <div class="pagination" id="pagination"></div>
    </section>

    <footer class="footer">
      <div class="logo">
        <i class="fas fa-film"></i>
        <span>MovieHub</span>
      </div>
      <p>
        Stream and download your favorite movies in high quality. All rights
        reserved.
      </p>
    </footer>

    <script>
      // API configuration
      function slugify(title) {
        return String(title)
          .toLowerCase()
          .trim()
          .replace(/[^a-z0-9]+/g, "-") // Replace non-alphanumeric with hyphen
          .replace(/^-+|-+$/g, ""); // Trim starting and ending hyphens
      }

      const API_URL =
        "https://imdb236.p.rapidapi.com/api/imdb/most-popular-movies";

      const API_OPTIONS = {
        method: "GET",
        headers: {
          "x-rapidapi-key":
            "1a23d5e762mshc6bdd66106811a0p1f4639jsn258336f3b440",
          "x-rapidapi-host": "imdb236.p.rapidapi.com",
        },
      };

      const itemsPerPage = 8;
      let currentPage = 1;
      let currentFilter = "all";
      let currentSort = "default";
      let allMovies = [];

      const movieGrid = document.getElementById("movieGrid");
      const pagination = document.getElementById("pagination");
      const searchInput = document.getElementById("searchInput");
      const filterButtons = document.querySelectorAll(".filter-btn");
      const sortOptions = document.getElementById("sortOptions");

      // Function to process movie data from API
      function processMovieData(movie) {
        const qualityOptions = ["HD", "4K", "FHD", "HDR"];
        const genreOptions = movie.genreList
          ? movie.genreList.map((g) => g.value)
          : ["Action", "Drama", "Comedy", "Sci-Fi"];
        const year = movie.year ? movie.year : "2023";

        return {
          id: movie.id,
          title: movie.primaryTitle || movie.originalTitle || "Untitled",
          poster:
            movie.primaryImage ||
            "https://source.unsplash.com/random/300x450/?movie",
          genres: movie.genres || movie.interests || [],
          description: movie.description || "No description available.",
          releaseDate:
            movie.releaseDate?.split("-")[0] || movie.startYear || "Upcoming",
          rating:
            movie.averageRating?.toFixed(1) ||
            (Math.random() * 2 + 3).toFixed(1),
          quality:
            qualityOptions[Math.floor(Math.random() * qualityOptions.length)],
          duration: movie.runtimeMinutes
            ? `${Math.floor(movie.runtimeMinutes / 60)}h ${
                movie.runtimeMinutes % 60
              }m`
            : "2h 0m",
          trailer: movie.trailer || null,
          imdbUrl: movie.url || "#",
        };
      }

      // Function to fetch latest movies from API
      async function fetchLatestMovies() {
        try {
          movieGrid.innerHTML = `
          <div class="loading">
            <div class="spinner"></div>
            <p>Loading movies from IMDb...</p>
          </div>
        `;

          const response = await fetch(API_URL, API_OPTIONS);

          if (!response.ok) {
            throw new Error(`API error: ${response.status}`);
          }

          const data = await response.json();
          console.log(data, "---------server"); // or use this data in your app

          if (!data || !Array.isArray(data)) {
            throw new Error("Invalid API response format");
          }

          // Process the movie data
          allMovies = data.map(processMovieData);
          displayMovies();
        } catch (error) {
          console.error("Error fetching movies:", error);
          movieGrid.innerHTML = `
          <div style="grid-column:1/-1; text-align:center; padding:2rem; color:#ef4444">
            <i class="fas fa-exclamation-triangle" style="font-size:3rem; margin-bottom:1rem;"></i>
            <h3>Failed to load movies</h3>
            <p>${error.message || "Please try again later"}</p>
            <button class="btn btn-primary" style="margin-top:1rem;" onclick="fetchLatestMovies()">
              <i class="fas fa-sync-alt"></i>
              Retry
            </button>
          </div>
        `;
        }
      }

      // Function to display movies in the grid
      function displayMovies() {
        const searchText = searchInput.value.trim().toLowerCase();
        let filtered = allMovies.filter((m) => {
          const matchesSearch = m.title.toLowerCase().includes(searchText);

          // Check if the movie matches the current filter
          let matchesFilter = currentFilter === "all";
          if (!matchesFilter) {
            matchesFilter = m.genres.some((genre) => genre === currentFilter);
          }

          return matchesSearch && matchesFilter;
        });

        // Apply sorting
        if (currentSort === "rating") {
          filtered.sort((a, b) => parseFloat(b.rating) - parseFloat(a.rating));
        } else if (currentSort === "newest") {
          filtered.sort(
            (a, b) => parseInt(b.releaseDate) - parseInt(a.releaseDate)
          );
        }

        const start = (currentPage - 1) * itemsPerPage;
        const current = filtered.slice(start, start + itemsPerPage);

        movieGrid.innerHTML =
          current.length > 0
            ? current
                .map(
                  (m) =>
                    `
                <div class="movie-card">
                  <div class="movie-badge">${m.quality}</div>
                  <div class="movie-poster">
                    ${
                      m.poster.includes("http")
                        ? `<img src="${m.poster}" alt="${m.title}" style="width:100%; height:100%; object-fit:cover;">`
                        : `<i class="fas fa-film" style="font-size:3rem;"></i>`
                    }
                  </div>
                  <div class="movie-content">
                    <h3 class="movie-title">${m.title}</h3>
                    <p class="movie-desc">${m.description}</p>
                    <div class="movie-meta">
                      <span>${m.releaseDate}</span>
                      <span class="rating">
                        <i class="fas fa-star"></i>
                        ${m.rating}
                      </span>
                    </div>
                    <div class="movie-meta">
                      <span>${m.duration}</span>
                      <span>${m.genres.slice(0, 2).join(", ")}</span>
                    </div>
                    <div class="movie-actions">
                      <button class="action-btn">
                        <i class="fas fa-play"></i>
                        Trailer
                      </button>
                      <a href="Movies/${slugify(
                        m.title
                      )}.html"class="action-btn download-btn" style="text-decoration: none;">
  <i class="fas fa-download"></i>
  Download
</a>
                    </div>
                  </div>
                </div>`
                )
                .join("")
            : `<div style="grid-column:1/-1; text-align:center; padding:2rem; color:var(--gray-text)">
              <i class="fas fa-film" style="font-size:3rem; margin-bottom:1rem;"></i>
              <h3>No movies found</h3>
              <p>Try changing your search or filter criteria</p>
            </div>`;

        displayPagination(filtered.length);
      }

      // Function to display pagination
      function displayPagination(totalItems) {
        const pageCount = Math.ceil(totalItems / itemsPerPage) || 1;
        pagination.innerHTML = "";

        // Previous button
        const prevBtn = document.createElement("button");
        prevBtn.innerHTML = `<i class="fas fa-chevron-left"></i>`;
        prevBtn.disabled = currentPage === 1;
        prevBtn.addEventListener("click", () => {
          if (currentPage > 1) {
            currentPage--;
            displayMovies();
          }
        });
        pagination.appendChild(prevBtn);

        // Page buttons
        for (let i = 1; i <= pageCount; i++) {
          const btn = document.createElement("button");
          btn.textContent = i;
          btn.classList.toggle("active", i === currentPage);
          btn.addEventListener("click", () => {
            currentPage = i;
            displayMovies();
          });
          pagination.appendChild(btn);
        }

        // Next button
        const nextBtn = document.createElement("button");
        nextBtn.innerHTML = `<i class="fas fa-chevron-right"></i>`;
        nextBtn.disabled = currentPage === pageCount;
        nextBtn.addEventListener("click", () => {
          if (currentPage < pageCount) {
            currentPage++;
            displayMovies();
          }
        });
        pagination.appendChild(nextBtn);
      }

      // Event listeners
      searchInput.addEventListener("input", () => {
        currentPage = 1;
        displayMovies();
      });

      filterButtons.forEach((btn) =>
        btn.addEventListener("click", () => {
          filterButtons.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          currentFilter = btn.dataset.filter;
          currentPage = 1;
          displayMovies();
        })
      );

      sortOptions.addEventListener("change", (e) => {
        currentSort = e.target.value;
        currentPage = 1;
        displayMovies();
      });

      // Initialize the app
      fetchLatestMovies();
    </script>
  </body>
</html>
